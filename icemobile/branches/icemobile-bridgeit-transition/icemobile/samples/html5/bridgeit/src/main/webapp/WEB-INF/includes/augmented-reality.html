<div id="ar" title="See It" class="panel" >
    <h2>Augmented Reality</h2>
    <fieldset>
        <div class="row"><p class="normalText">Access an augmented world with a simple line of JavaScript...</p></div>
        <div class="row">
            <code>
                bridgeit.augmentedReality(id,<br/>
                &nbsp;&nbsp;callback, {postURL:myURL});
            </code>
        </div>
        <div class="row"><p class="normalText">Add a photo with a message to the Augmented Reality.</p></div>
    </fieldset>
    
    <input type="hidden" id="arLatitude" value="0"/>
    <input type="hidden" id="arLongitude" value="0"/>
    
    <a id="arCameraBtn" type="button" class="whiteButton bridgeItBtn"
                onclick="bridgeit.camera('arCameraBtn',handleARCam, {postURL:(''+window.location).match(/.*\//) + 'service/ar-upload'});">Take a Photo</a>
            
    <fieldset id="arImages">
    </fieldset>
    
    <a id="postARMessagesBtn" type="button" class="whiteButton bridgeItBtn"
        onclick="postARMessage();">Send AR Message</a>
    
    
    <a id="arBtn" type="button" class="whiteButton bridgeItBtn"
        onclick="launchAugmentedReality();">Enter Augmented Reality</a>
    
    <div class="footer">
        <a href="#">
            <img src="./images/icesoft-emblem.png" class="icesoft-emblem"/>
        </a>
        &copy; 2013 ICEsoft Technologies
    </div>
    <script type="text/javascript">
    function handleARCam(event)  {
        var text = event.value;
        if (event.response)  {
            var photo = event.response;
            var elem = document.getElementById("arImages");
            var index = elem.children.length;
            if( photo ){
                var row1 = document.createElement('div');
                row1.setAttribute('class','row');
                row1.innerHTML = "<img src='" + photo + "'/>"
                   + "<input type='text' placeholder='Add a title' id='arTitle'/>"
                   + "<input type='hidden' id='arPhoto' value='" + photo + "'/>";
                elem.appendChild(row1);
                setTimeout(function(){window.scrollTo(0,500);},0);
            }
        }
    }
    function setLocation(event){
        document.getElementById('arLatitude').value = event.coords.latitude;
        document.getElementById('arLongitude').value = event.coords.longitude;
    }
    function postARMessage(event){
        var xmlhttp;
        xmlhttp=new XMLHttpRequest();
        xmlhttp.onreadystatechange = function(event){
            if (xmlhttp.readyState==4 ){
                 var messages = JSON.parse(xmlhttp.responseText);
                 window.arMessages = '';
                 for( var i = 0 ; i < messages.length ; i++ ){
                     var msg = messages[i];
                     window.arMessages += '&' + msg.title + '=';
                     window.arMessages += msg.latitude + ',';
                     window.arMessages += msg.longitude + ',,,';
                     window.arMessages += msg.fileName ;
                 }
            }
        }
        xmlhttp.open("POST",(''+window.location).match(/.*\//) + 'service/post-ar-message',true);
        xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        var titleElem = document.getElementById('arTitle');
        var photoElem = document.getElementById('arPhoto');
        var latElem = document.getElementById('arLatitude');
        var longElem = document.getElementById('arLongitude');
        if( titleElem && photoElem ){
            var post = "title=" + encodeURIComponent(titleElem.value)
            + '&photo=' + encodeURIComponent(photoElem.value)
            + '&lat=' + encodeURIComponent(latElem.value)
            + '&lng=' + encodeURIComponent(longElem.value);
            xmlhttp.send(post);
        }
        
    }
    function failedToSetLocation(event){
        alert('could not retrieve location coordinates: ' + event);
    }
    function launchAugmentedReality(){
        bridgeit.augmentedReality('arBtn',null, 
            {parameters: encodeURIComponent(window.arMessages)});
    }
    var geoParams = {};
    geoParams.maximumAge = 3600000;
    geoParams.timeout = 60000;
    geoParams.enableHighAccuracy = true;
    navigator.geolocation.getCurrentPosition(setLocation, failedToSetLocation, geoParams);
    </script>
   
</div>
