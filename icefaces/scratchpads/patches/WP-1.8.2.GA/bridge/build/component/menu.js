Ice.Menu=Class.create();Ice.Menu={menuContext:null,currentMenu:null,currentHover:null,openMenus:new Array(0),printOpenMenus:function(){var B="";for(var A=0;A<Ice.Menu.openMenus.length;A++){B=B+Ice.Menu.openMenus[A].id+" , ";}return B;},printHoverMenuAndOpenMenus:function(A){alert("hoverMenu=["+A.id+"]\nopenMenus=["+Ice.Menu.printOpenMenus()+"]");},printArray:function(C){var A="";for(var B=0;B<C.length;B++){A=A+C[B]+", ";}return A;},printArrayOfIds:function(C){var A="";for(var B=0;B<C.length;B++){A=A+C[B].id+", ";}return A;},hideAll:function(){for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].iframe){Ice.Menu.openMenus[A].iframe.hide();}Ice.Menu.openMenus[A].style.display="none";}Ice.Menu.openMenus=new Array();Ice.Menu.currentMenu=null;Ice.Menu.menuContext=null;Ice.Menu.currentHover=null;},getPosition:function(C,B){var A=0;while(C!=null){A+=C["offset"+B];C=C.offsetParent;}return A;},show:function(H,A,D){if(A){var B=$(A);if(B&&B.style.display==""){return ;}Ice.Menu.showMenuWithId(A);var I=H.viewportOffset(),J=A.viewportOffset(),F=document.viewport,C=H.offsetWidth,L=A.offsetWidth,E=A.offsetHeight,K=H.offsetHeight;D=$(D);if(D){var G=D.offsetHeight;if(I.left+C+L<F.getWidth()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:C},I);}else{A.clonePosition(H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:C});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:-L},I);}else{A.clonePosition(H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:-L});}}if(D.viewportOffset().top+E<F.getHeight()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,D,{setLeft:false,setWidth:false,setHeight:false});}else{A.clonePosition(D,{setLeft:false,setWidth:false,setHeight:false});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,D,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-E+G});}else{A.clonePosition(D,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-E+G});}}}else{if(I.left+L<F.getWidth()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setTop:false,setWidth:false,setHeight:false},I);}else{A.clonePosition(H,{setTop:false,setWidth:false,setHeight:false});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:F.getWidth()-I.left-L},I);}else{A.clonePosition(H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:F.getWidth()-I.left-L});}}if(I.top+K+E<F.getHeight()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setLeft:false,setWidth:false,setHeight:false,offsetTop:K},I);}else{A.clonePosition(H,{setLeft:false,setWidth:false,setHeight:false,offsetTop:K});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-E},I);}else{A.clonePosition(H,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-E});}}}if(J.top<0){if(Prototype.Browser.IE){Ice.clonePositionIE(A,A,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-J.top},J);}else{A.clonePosition(A,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-J.top});}}Ice.Menu.showIframe(A);}Ice.Menu.currentMenu=A;},showPopup:function(C,B,A){Ice.Menu.hideAll();A=$(A);if(A){Ice.Menu.showMenuWithId(A);var E=C+"px";A.style.left=E;var D=B+"px";A.style.top=D;Ice.Menu.showIframe(A);}Ice.Menu.currentMenu=A;},showIframe:function(C){if(!Prototype.Browser.IE){return ;}if(parseFloat(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))>=7){return ;}var B=C.iframe;if(!B){var A=Ice.ElementModel.Element.adaptToElement(C).findConnection().sendURI;var D=A.substring(0,A.indexOf("block/send-receive-updates"));var E=D+"xmlhttp/blank";C.iframe=B=new Element("iframe",{src:E,frameborder:"0",scrolling:"no"});B.setStyle({position:"absolute",opacity:0}).hide();C.insert({before:B});}if(Prototype.Browser.IE){Ice.clonePositionIE(B,C);}else{Element.clonePosition(B,C);}B.show();},contextMenuPopup:function(D,B,G){var F=$(B+"_dynamic");if(!D){D=window.event;}if(D){D.returnValue=false;D.cancelBubble=true;if(D.stopPropagation){D.stopPropagation();}var A=0;var H=0;if(D.pageX||D.pageY){A=D.pageX;H=D.pageY;}else{if(D.clientX||D.clientY){A=D.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;H=D.clientY+document.body.scrollTop+document.documentElement.scrollTop;}}if(F){F.value=A+", "+H+", "+B+", "+G;try{var C=Ice.util.findForm(F);iceSubmitPartial(C,F,D);}catch(E){logger.info("Form not found"+E);}return ;}Ice.Menu.showIt(A,H,B,G);}},showIt:function(A,D,B,C){Ice.Menu.showPopup(A,D,B.strip());Event.observe(document,"click",Ice.Menu.hidePopupMenu);Ice.Menu.setMenuContext(C.strip());},setMenuContext:function(A){if(Ice.Menu.menuContext==null){Ice.Menu.menuContext=A;}},hideOrphanedMenusNotRelatedTo:function(H){var I=new Array();var G=H.id.split(":");var A="";for(var F=0;F<G.length;F++){A=A+G[F];var B=new Array(A+"_sub");I=I.concat(B);A=A+":";}var E=Ice.Menu.openMenus.length;var J=new Array();for(var D=0;D<E;D++){var L=$(Ice.Menu.openMenus[D]);var K="false";for(var C=0;C<I.length;C++){if(L.id==I[C]){K="true";}}if(K!="true"){J[J.length]=L.id;if(L==Ice.Menu.currentMenu){Ice.Menu.currentMenu=null;}}}Ice.Menu.hideMenusWithIdsInArray(J);},hideSubmenu:function(C){var D=Ice.Menu.currentMenu;var A=C.id.substring(0,C.id.lastIndexOf(":"));var B=D.id.substring(0,D.id.lastIndexOf(":"));if(A==B){Ice.Menu.hideMenuWithId(Ice.Menu.currentMenu);}},hideMenusWithIdsInArray:function(B){if(B){for(var A=0;A<B.length;A++){Ice.Menu.hideMenuWithId(B[A]);}}},hideMenuWithId:function(A){A=$(A);if(A){if(A.iframe){A.iframe.hide();}A.style.display="none";Ice.Menu.removeFromOpenMenus(A);}return ;},removeFromOpenMenus:function(C){var B=new Array();for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].id!=C.id){B=B.concat(new Array(Ice.Menu.openMenus[A]));}}Ice.Menu.openMenus=B;},showMenuWithId:function(A){if(A){A=$(A);A.style.display="";Ice.Menu.addToOpenMenus(A);}},addToOpenMenus:function(D){if(D){D=$(D);var C="false";for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].id==D.id){C="true";break;}}if(C!="true"){var B=new Array(D);Ice.Menu.openMenus=Ice.Menu.openMenus.concat(B);}}},appendHoverClasses:function(C){var A=C.className.replace(/^\s+|\s+$/g,"").split(/\s+/);if(A[0]==""){return ;}for(var B=0;B<A.length;B++){if(A[B]=="portlet-menu-item-selected"){C.className+=" portlet-menu-item-hover-selected";}else{C.className+=" "+A[B]+"-hover";}}},removeHoverClasses:function(B){var C=B.className.replace(/^\s+|\s+$/g,"").split(/\s+/).length/2;var A=new RegExp("( portlet-menu-item-hover-selected| \\S+-hover){"+C+"}$");B.className=B.className.replace(A,"");},hidePopupMenu:function(){Ice.Menu.hideAll();Event.stopObserving(document,"click",Ice.Menu.hidePopupMenu);},hideOnMouseOut:function(C,B){if(!B){B=window.event;}if(B){var A;A=B.relatedTarget;if(!A){A=B.toElement;}if(A){if(!Ice.Menu.isInMenu(A,C)){Ice.Menu.hideAll();}}}},isInMenu:function(A,B){if(A.id==B){return true;}if(A==undefined||A==document){return false;}return Ice.Menu.isInMenu(A.parentNode,B);}};Ice.clonePositionIE=function(E,A,L,K){logger.info("Using clonePosition() optimized for IE");var L=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});E=$(E);var B=null;if(K){B=K;}else{B=A.viewportOffset();}var J=[0,0];var I=null;if(Element.getStyle(E,"position")=="absolute"){I=E.getOffsetParent();var H=Element.getStyle(I,"top");var C=Element.getStyle(I,"left");var F=document.documentElement.scrollTop;var D=document.documentElement.scrollLeft;var G=false;_viewportOffset=I._viewportOffset;if(!_viewportOffset){I._top=null;I._left=null;I._bodyScrollTop=F;I._bodyScrollLeft=D;G=true;}else{G=!((I._top==H&&I._left==C)&&(I._bodyScrollTop==F&&I._bodyScrollLeft==D));}I._top=H;I._left=C;I._bodyScrollTop=F;I._bodyScrollLeft=D;if(G){J=I.viewportOffset();I._viewportOffset=J;}else{J=I._viewportOffset;}}if(L.setLeft){E.style.left=(B[0]-J[0]+L.offsetLeft)+"px";}if(L.setTop){E.style.top=(B[1]-J[1]+L.offsetTop)+"px";}if(L.setWidth){E.style.width=A.offsetWidth+"px";}if(L.setHeight){E.style.height=A.offsetHeight+"px";}return E;};