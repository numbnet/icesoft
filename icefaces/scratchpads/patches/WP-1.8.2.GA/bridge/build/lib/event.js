[Ice.EventModel=new Object,Ice.ElementModel.Element,Ice.Parameter.Query,Ice.Geometry].as(function(E,B,A,G){E.IE=new Object;E.Netscape=new Object;E.Event=Object.subclass({initialize:function(I,H){this.event=I;this.currentElement=H;},cancel:function(){this.cancelBubbling();this.cancelDefaultAction();},isKeyEvent:function(){return false;},isMouseEvent:function(){return false;},captured:function(){return this.currentElement?B.adaptToElement(this.currentElement):null;},serializeEventOn:function(H){H.add("ice.event.target",this.target()&&this.target().id());H.add("ice.event.captured",this.captured()&&this.captured().id());H.add("ice.event.type","on"+this.event.type);},serializeOn:function(H){this.serializeEventOn(H);},sendOn:function(H){A.create(function(I){I.add("ice.submit.partial",false);try{this.captured().serializeOn(I);this.serializeOn(I);}catch(J){this.serializeOn(I);}}.bind(this)).sendOn(H);},sendFullOn:function(H){A.create(function(I){I.add("ice.submit.partial",false);try{this.captured().serializeOn(I);this.form().serializeOn(I);this.serializeOn(I);}catch(J){this.serializeOn(I);}}.bind(this)).sendOn(H);},sendWithCondition:function(H){if(H(this)){this.send();}},send:function(){this.cancel();this.sendOn(this.captured().findConnection());},sendFull:function(){this.cancel();this.sendFullOn(this.captured().findConnection());}});E.IE.Event=E.Event.subclass({target:function(){return this.event.srcElement?B.adaptToElement(this.event.srcElement):null;},cancelBubbling:function(){this.event.cancelBubble=true;},cancelDefaultAction:function(){this.event.returnValue=false;}});E.Netscape.Event=E.Event.subclass({target:function(){if(window.blackberry){return this.event.currentTarget?B.adaptToElement(this.event.currentTarget):null;}return this.event.target?B.adaptToElement(this.event.target):null;},cancelBubbling:function(){this.event.stopPropagation();},cancelDefaultAction:function(){this.event.preventDefault();}});var F={isAltPressed:function(){return this.event.altKey;},isCtrlPressed:function(){return this.event.ctrlKey;},isShiftPressed:function(){return this.event.shiftKey;},isMetaPressed:function(){return this.event.metaKey;},serializeKeyAndMouseEventOn:function(H){H.add("ice.event.alt",this.isAltPressed());H.add("ice.event.ctrl",this.isCtrlPressed());H.add("ice.event.shift",this.isShiftPressed());H.add("ice.event.meta",this.isMetaPressed());}};var D={isMouseEvent:function(){return true;},serializeOn:function(H){this.serializeEventOn(H);this.serializeKeyAndMouseEventOn(H);this.pointer().serializeOn(H);H.add("ice.event.left",this.isLeftButton());H.add("ice.event.right",this.isRightButton());}};E.IE.MouseEvent=E.IE.Event.subclass({pointer:function(){return new G.Point(this.event.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft),this.event.clientY+(document.documentElement.scrollTop||document.body.scrollTop));},isLeftButton:function(){return this.event.button==1;},isRightButton:function(){return this.event.button==2;}});E.IE.MouseEvent.methods(F);E.IE.MouseEvent.methods(D);E.Netscape.MouseEvent=E.Netscape.Event.subclass({pointer:function(){return new G.Point(this.event.pageX,this.event.pageY);},isLeftButton:function(){return this.event.which==1;},isRightButton:function(){return this.event.which==3;}});E.Netscape.MouseEvent.methods(F);E.Netscape.MouseEvent.methods(D);var C={keyCharacter:function(){return String.fromCharCode(this.keyCode());},isEnterKey:function(){return this.keyCode()==13;},isEscKey:function(){return this.keyCode()==27;},isBackspaceKey:function(){return this.keyCode()==8;},isDeleteKey:function(){return this.keyCode()==46||this.keyCode()==63272;},isSpaceKey:function(){return this.keyCode()==32;},isTabKey:function(){return this.keyCode()==9||(this.isShiftPressed()&&this.keyCode()==25);},isHomeKey:function(){return this.keyCode()==36||this.keyCode()==63273;},isEndKey:function(){return this.keyCode()==35||this.keyCode()==63275;},isPageUpKey:function(){return this.keyCode()==33||this.keyCode()==63276;},isPageDownKey:function(){return this.keyCode()==34||this.keyCode()==63277;},isArrowUpKey:function(){return this.keyCode()==38||this.keyCode()==63232;},isArrowDownKey:function(){return this.keyCode()==40||this.keyCode()==63233;},isArrowLeftKey:function(){return this.keyCode()==37||this.keyCode()==63234;},isArrowRightKey:function(){return this.keyCode()==39||this.keyCode()==63235;},isKeyEvent:function(){return true;},serializeOn:function(H){this.serializeEventOn(H);this.serializeKeyAndMouseEventOn(H);H.add("ice.event.keycode",this.keyCode());}};E.IE.KeyEvent=E.IE.Event.subclass({keyCode:function(){return this.event.keyCode;}});E.IE.KeyEvent.methods(F);E.IE.KeyEvent.methods(C);E.Netscape.KeyEvent=E.Netscape.Event.subclass({keyCode:function(){return this.event.which==0?this.event.keyCode:this.event.which;}});E.Netscape.KeyEvent.methods(F);E.Netscape.KeyEvent.methods(C);E.UnknownEvent=E.Event.subclass({initialize:function(H){this.currentElement=H;},target:function(){return this.currentElement==null?null:B.adaptToElement(this.currentElement);},serializeEventOn:function(H){H.add("ice.event.target",this.target()&&this.target().id());H.add("ice.event.captured",this.captured()&&this.captured().id());H.add("ice.event.type","unknown");},cancelBubbling:Function.NOOP,cancelDefaultAction:Function.NOOP});E.Event.adaptToPlainEvent=function(I,H){return window.event?new E.IE.Event(event,H):new E.Netscape.Event(I,H);};E.Event.adaptToMouseEvent=function(I,H){return window.event?new E.IE.MouseEvent(event,H):new E.Netscape.MouseEvent(I,H);};E.Event.adaptToKeyEvent=function(I,H){return window.event?new E.IE.KeyEvent(event,H):new E.Netscape.KeyEvent(I,H);};E.Event.adaptToEvent=function(K,H){var J=window.event||K;if(J){var I="on"+J.type;var L=function(M){return M.toLowerCase()==I;};if(B.prototype.KeyListenerNames.detect(L)){return E.Event.adaptToKeyEvent(K,H);}else{if(B.prototype.MouseListenerNames.detect(L)){return E.Event.adaptToMouseEvent(K,H);}else{return E.Event.adaptToPlainEvent(K,H);}}}else{return new E.UnknownEvent(H);}};window.$event=E.Event.adaptToEvent;});