[Ice.Log=new Object].as(function(A){A.Priority=Object.subclass({debug:function(C,E,D,B){C.debug(E,D,B);},info:function(C,E,D,B){C.info(E,D,B);},warn:function(C,E,D,B){C.warn(E,D,B);},error:function(C,E,D,B){C.error(E,D,B);}});A.Debug=A.Priority.subclass({asString:function(){return"Debug";}});A.Info=A.Debug.subclass({debug:Function.NOOP,asString:function(){return"Info";}});A.Warn=A.Info.subclass({info:Function.NOOP,asString:function(){return"Warn";}});A.Error=A.Warn.subclass({warn:Function.NOOP,asString:function(){return"Error";}});A.Priority.DEBUG=new A.Debug;A.Priority.INFO=new A.Info;A.Priority.WARN=new A.Warn;A.Priority.ERROR=new A.Error;A.Priority.Levels=[A.Priority.DEBUG,A.Priority.INFO,A.Priority.WARN,A.Priority.ERROR];A.Logger=Object.subclass({initialize:function(D,C,B){this.handler=C||{debug:Function.NOOP,info:Function.NOOP,warn:Function.NOOP,error:Function.NOOP};this.category=D;this.children=[];this.priority=B||A.Priority.ERROR;},debug:function(C,B){this.priority.debug(this.handler,this.category,C,B);},info:function(C,B){this.priority.info(this.handler,this.category,C,B);},warn:function(C,B){this.priority.warn(this.handler,this.category,C,B);},error:function(C,B){this.priority.error(this.handler,this.category,C,B);},child:function(C){var B=this.category.copy();B.push(C);var D=new A.Logger(B,this.handler,this.priority);this.children.push(D);return D;},threshold:function(B){this.priority=B;this.children.each(function(C){C.threshold(B);});},handleWith:function(B){this.handler=B;}});A.WindowLogHandler=Object.subclass({initialize:function(D,E,B,C){this.lineOptions=[25,50,100,200,400];this.logger=D;this.logger.handleWith(this);this.parentWindow=E;this.lines=B||this.lineOptions[3];this.thresholdPriority=C||A.Priority.DEBUG;this.categoryMatcher=/.*/;this.closeOnExit=true;this.toggle();this.parentWindow.onKeyUp(function(G){var F=G.keyCode();if((F==20||F==84)&&(G.isCtrlPressed()||G.isAltPressed())&&G.isShiftPressed()){this.enable();}}.bind(this));this.parentWindow.onUnload(function(){window.logger.info("page unloaded!");this.disable();}.bind(this));},enable:function(){try{this.window=this.parentWindow.open("","log"+window.identifier,"scrollbars=1,width=800,height=680");var D=this.window.document;this.log=this.window.document.getElementById("log-window");this.toggle();if(this.log){return ;}D.body.appendChild(D.createTextNode(" Close on exit "));var I=D.createElement("input");I.style.margin="2px";I.setAttribute("type","checkbox");I.defaultChecked=true;I.checked=true;I.onclick=function(){this.closeOnExit=I.checked;}.bind(this);D.body.appendChild(I);D.body.appendChild(D.createTextNode(" Lines "));var C=D.createElement("select");C.style.margin="2px";this.lineOptions.each(function(L,J){var K=C.appendChild(D.createElement("option"));if(this.lines==L){C.selectedIndex=J;}K.appendChild(D.createTextNode(L.toString()));}.bind(this));C.onchange=function(J){this.lines=this.lineOptions[C.selectedIndex];this.clearPreviousEvents();}.bind(this);D.body.appendChild(C);D.body.appendChild(D.createTextNode(" Category "));var H=D.createElement("input");H.style.margin="2px";H.setAttribute("type","text");H.setAttribute("value",this.categoryMatcher.source);H.onchange=function(){this.categoryMatcher=H.value.asRegexp();}.bind(this);D.body.appendChild(H);D.body.appendChild(D.createTextNode(" Level "));var B=D.createElement("select");B.style.margin="2px";A.Priority.Levels.each(function(K,J){var L=B.appendChild(D.createElement("option"));if(this.thresholdPriority==K){B.selectedIndex=J;}L.appendChild(D.createTextNode(K.asString()));}.bind(this));this.logger.threshold(this.thresholdPriority);B.onchange=function(J){this.thresholdPriority=A.Priority.Levels[B.selectedIndex];this.logger.threshold(this.thresholdPriority);}.bind(this);D.body.appendChild(B);var F=D.createElement("input");F.style.margin="2px";F.setAttribute("type","button");F.setAttribute("value","Stop");F.onclick=function(){F.setAttribute("value",this.toggle()?"Stop":"Start");}.bind(this);D.body.appendChild(F);var G=D.createElement("input");G.style.margin="2px";G.setAttribute("type","button");G.setAttribute("value","Clear");G.onclick=function(){this.clearAllEvents();}.bind(this);D.body.appendChild(G);this.log=D.body.appendChild(D.createElement("pre"));this.log.id="log-window";this.log.style.width="100%";this.log.style.minHeight="0";this.log.style.maxHeight="550px";this.log.style.borderWidth="1px";this.log.style.borderStyle="solid";this.log.style.borderColor="#999";this.log.style.backgroundColor="#ddd";this.log.style.overflow="scroll";this.window.onunload=function(){this.disable();}.bind(this);}catch(E){this.disable();}},disable:function(){this.logger.threshold(A.Priority.ERROR);this.handle=Function.NOOP;if(this.closeOnExit&&this.window){this.window.close();}},toggle:function(){if(this.handle==Function.NOOP){delete this.handle;return true;}else{this.handle=Function.NOOP;return false;}},debug:function(D,C,B){this.handle("#333","debug",D,C,B);},info:function(D,C,B){this.handle("green","info",D,C,B);},warn:function(D,C,B){this.handle("orange","warn",D,C,B);},error:function(D,C,B){this.handle("red","error",D,C,B);},handle:function(I,E,B,J,C){try{if(this.categoryMatcher.test(B.join("."))){var F=this.log.ownerDocument;var H=(new Date()).toTimestamp();var D=B.join(".");("["+D+"] : "+J+(C?("\n"+C):"")).split("\n").each(function(K){if(K.containsWords()){var L=F.createElement("div");L.style.padding="3px";L.style.color=I;L.setAttribute("title",H+" | "+E);this.log.appendChild(L).appendChild(F.createTextNode(K));}}.bind(this));this.log.scrollTop=this.log.scrollHeight;}this.clearPreviousEvents();}catch(G){this.disable();}},clearPreviousEvents:function(){var B=$A(this.log.childNodes);B.copyFrom(0,B.length-this.lines).each(function(C){this.log.removeChild(C);}.bind(this));},clearAllEvents:function(){$A(this.log.childNodes).each(function(B){this.log.removeChild(B);}.bind(this));}});A.NOOPConsole={debug:Function.NOOP,info:Function.NOOP,warn:Function.NOOP,error:Function.NOOP};A.FirebugLogHandler=Object.subclass({initialize:function(B){B.handleWith(this);this.logger=B;this.console=A.NOOPConsole;this.enable();},enable:function(){this.console=window.console;this.logger.threshold(A.Priority.DEBUG);this.logger.warn("Firebug (version < 1.2) logging can cause increased memory consumption when running for a long period of time!");},disable:function(){this.console=A.NOOPConsole;this.logger.threshold(A.Priority.ERROR);},toggle:Function.NOOP,debug:function(D,C,B){B?this.console.debug(this.format(D,C),B):this.console.debug(this.format(D,C));},info:function(D,C,B){B?this.console.info(this.format(D,C),B):this.console.info(this.format(D,C));},warn:function(D,C,B){B?this.console.warn(this.format(D,C),B):this.console.warn(this.format(D,C));},error:function(D,C,B){B?this.console.error(this.format(D,C),B):this.console.error(this.format(D,C));},format:function(C,B){return"["+C.join(".")+"] "+B;}});});