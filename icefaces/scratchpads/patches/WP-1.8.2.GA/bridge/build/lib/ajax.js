[Ice.Ajax=new Object].as(function(A){A.Client=Object.subclass({initialize:function(B){this.logger=B;this.cookies=new Object;document.cookie.split("; ").each(function(E){var D=E.split("=");this.cookies[D.first()]=D.last();}.bind(this));try{if(window.createRequest){this.createRequest=function(){var D=new A.RequestProxy(window.createRequest(),this.logger);D.post=function(E,H,F,G){this.get(E,H,F,G);};return D;}.bind(this);}else{if(window.XMLHttpRequest){this.createRequest=function(){return new A.RequestProxy(new XMLHttpRequest(),this.logger);}.bind(this);}else{if(window.ActiveXObject){this.createRequest=function(){return new A.RequestProxy(new ActiveXObject("Microsoft.XMLHTTP"),this.logger);}.bind(this);}}}}catch(C){this.logger.error("failed to create factory request",C);}},getAsynchronously:function(D,B,C){return this.createRequest().getAsynchronously(D,B,C);},getSynchronously:function(D,B,C){return this.createRequest().getSynchronously(D,B,C);},postAsynchronously:function(D,B,C){return this.createRequest().postAsynchronously(D,B,C);},postSynchronously:function(D,B,C){return this.createRequest().postSynchronously(D,B,C);}});A.RequestProxy=Object.subclass({initialize:function(D,C){this.identifier=+Math.random().toString().substr(2,7);this.request=D;this.logger=C;this.callbacks=[];var B=this;this.responseCallback=function(){if(D.readyState==4){B.logger.debug("["+B.identifier+"] : receive ["+B.statusCode()+"] "+B.statusText());var F=B.callbacks.length;for(var E=0;E<F;E++){try{B.callbacks[E](B);}catch(G){C.warn("connection closed prematurely",G);B.close();}}}};},statusCode:function(){try{return this.request.status;}catch(B){return 0;}},statusText:function(){try{return this.request.statusText;}catch(B){return"";}},on:function(C,B){this.callbacks.push(function(D){if(C(D)){B(D);}});},isServerError:function(){try{return this.request.status==500;}catch(B){return false;}},isEmpty:function(){try{return this.request.responseText=="";}catch(B){return true;}},getAsynchronously:function(D,B,C){this.request.open("GET",D+"?"+B+"&rand="+Math.random(),true);if(C){C(this);}this.request.onreadystatechange=this.responseCallback;this.logger.debug("["+this.identifier+"] : send asynchronous GET");this.request.send("");return this;},postAsynchronously:function(D,B,C){this.request.open("POST",D,true);if(C){C(this);}this.request.onreadystatechange=this.responseCallback;this.logger.debug("["+this.identifier+"] : send asynchronous POST");this.request.send(B+"&rand="+Math.random()+"\n\n");return this;},getSynchronously:function(D,B,C){this.request.open("GET",D+"?"+B+"&rand="+Math.random(),false);if(C){C(this);}this.logger.debug("["+this.identifier+"] : send synchronous GET");this.request.send("");this.responseCallback();return this;},postSynchronously:function(D,B,C){this.request.open("POST",D,false);if(C){C(this);}this.logger.debug("["+this.identifier+"] : send synchronous POST");this.request.send(B+"&rand="+Math.random()+"\n\n");this.responseCallback();return this;},setRequestHeader:function(B,C){this.request.setRequestHeader(B,C);},getResponseHeader:function(B){try{return this.request.getResponseHeader(B);}catch(C){return null;}},containsResponseHeader:function(B){try{var D=this.request.getResponseHeader(B);return D&&D!="";}catch(C){return false;}},content:function(){try{return this.request.responseText;}catch(B){return"";}},contentAsDOM:function(){return this.request.responseXML;},abort:function(){if(this.request){try{this.request.onreadystatechange=Function.NOOP;this.request.abort();}catch(B){}finally{this.request=null;this.logger.debug("["+this.identifier+"] : connection aborted");}}},close:function(){if(this.request){try{this.request.onreadystatechange=Function.NOOP;}catch(B){}finally{this.request=null;this.logger.debug("["+this.identifier+"] : connection closed");}}}});});