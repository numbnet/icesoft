Ice.treeNavigator=Class.create();Ice.treeNavigator={handleFocus:function(F,B,A){var E=F.type;if(E=="click"){Ice.treeNavigator.reset();return ;}var G=Event.element(F);var C=F.keyCode;var D=null;if(G&&G.firstChild.getAttribute){D=G.firstChild.getAttribute("src");}if(!D){return ;}switch(C){case 37:if(D.indexOf("top_close_no_siblings")>0||D.indexOf("middle_close")>0||D.indexOf("bottom_close")>0){logger.info("LEFT_KEY: top_close_no_siblings FOUND, root Node opend close it and reinitialize index");G.onclick();Ice.treeNavigator.reset();return false;}break;case 39:if(D.indexOf("top_open_no_siblings")>0||D.indexOf("middle_open")>0||D.indexOf("bottom_open")>0){G.onclick();Ice.treeNavigator.reset();return false;}break;case 38:if(!Ice.treeNavigator.anchors){Ice.treeNavigator.updateAnchor(B,G,A);}if(D){if(D.indexOf("top_close_no_siblings")>0){Ice.treeNavigator.index=1;Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();}Ice.treeNavigator.focusPrevious();}else{Ice.treeNavigator.focusPrevious();}return false;case 40:logger.info("down");if(!Ice.treeNavigator.anchors){Ice.treeNavigator.updateAnchor(B,G,A);}Ice.treeNavigator.focusNext();return false;}},index:0,anchors:null,reset:function(){Ice.treeNavigator.index=0;Ice.treeNavigator.anchors=null;},focusNext:function(A){if(Ice.treeNavigator.index<(Ice.treeNavigator.anchors.length-1)){Ice.treeNavigator.index=Ice.treeNavigator.index+1;}Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();},focusPrevious:function(A){if(Ice.treeNavigator.index>0){Ice.treeNavigator.index=Ice.treeNavigator.index-1;}Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();},updateAnchor:function(B,D,A){var C=[];if(A){C=B.parentNode.getElementsByTagName("a");for(i=0;C.length>i;i++){if(D==C[i]){Ice.treeNavigator.index=i;}}}else{_anchors=B.parentNode.getElementsByTagName("a");j=0;for(i=0;_anchors.length>i;i++){if(_anchors[i].firstChild.src&&_anchors[i].firstChild.src.indexOf("tree_nav")>0){if(D==_anchors[i]){Ice.treeNavigator.index=j;}C[j++]=_anchors[i];}}}Ice.treeNavigator.anchors=C;}};