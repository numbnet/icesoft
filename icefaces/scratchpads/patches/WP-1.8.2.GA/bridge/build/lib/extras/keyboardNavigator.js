Ice.KeyNavigator=Class.create({initialize:function(A){this.component=$(A);this.component.onkeydown=this.keydown.bindAsEventListener(this);},keydown:function(A){this.srcElement=Event.element(A);switch(A.keyCode){case Event.KEY_RETURN:this.showMenu(A);break;case Event.KEY_UP:this.goNorth(A);Event.stop(A);break;case Event.KEY_DOWN:this.goSouth(A);Event.stop(A);break;case Event.KEY_LEFT:this.goWest(A);Event.stop(A);break;case Event.KEY_RIGHT:this.goEast(A);Event.stop(A);break;}},goNorth:function(A){},goSouth:function(A){},goWest:function(A){},goEast:function(A){}});Ice.MenuBarKeyNavigator=Class.create(Ice.KeyNavigator,{initialize:function($super,A,B){$super(A);this.displayOnClick=B;this.component.onclick=this.hideAll.bindAsEventListener(this);document.onclick=this.hideAllDocument.bindAsEventListener(this);if(Element.hasClassName(this.component,"iceMnuBarVrt")){this.vertical=true;}else{this.vertical=false;}this.clicked=true;this.configureRootItems();}});Ice.MenuBarKeyNavigator.addMethods({goEast:function(A){this.applyFocus("e");},goWest:function(A){this.applyFocus("w");},goSouth:function(A){this.applyFocus("s");},goNorth:function(A){this.applyFocus("n");},focusMenuItem:function(B,E,G){var D=this.srcElement.up(B);if(D){if(G=="e"){var F=$(D.id+"_sub");this.focusAnchor(F);return ;}if(G=="w"){var A=$(D.id.substring(0,D.id.length-6));if(A){this.focusAnchor(A);}else{this.focusAnchor($(D.id.substring(0,D.id.lastIndexOf(":"))));}return ;}var C=null;if(E){C=D.next(B);}else{C=D.previous(B);if(!C&&G=="n"){this.focusAnchor($(D.id.substring(0,D.id.lastIndexOf(":"))));return ;}}this.focusAnchor(C);}},focusSubMenuItem:function(A){if(A){var B=$(A.id+"_sub");this.focusAnchor(B);}},focusAnchor:function(B){if(B){try{var A=B.down("a");A.focus();}catch(C){}}},applyFocus:function(E){var C=this.srcElement.parentNode;var B=Element.hasClassName(C,this.getPopupMenuClass());var D=Element.hasClassName(C,this.getMenuBarItemClass());var A=Element.hasClassName(C,this.getMenuItemClass());if(D){switch(E){case"s":if(this.vertical){this.focusMenuItem("."+this.getMenuBarItemClass(),true);}else{this.focusSubMenuItem(C);}break;case"e":if(this.vertical){this.focusSubMenuItem(C);}else{this.focusMenuItem("."+this.getMenuBarItemClass(),true);}break;case"w":this.focusMenuItem("."+this.getMenuBarItemClass());break;case"n":if(this.vertical){this.focusMenuItem("."+this.getMenuBarItemClass());}break;}}else{if(A){this.focusMenuItem("."+this.getMenuItemClass(),E=="s",E);}else{if(B){switch(E){case"n":this.focusMenuItem("."+this.getPopupMenuClass());break;case"s":this.focusMenuItem("."+this.getPopupMenuClass(),true);break;case"e":this.focusSubMenuItem(C);break;}}}}},getMenuBarItemClass:function(A){if(this.vertical){return"iceMnuBarVrtItem";}else{return"iceMnuBarItem";}},getSubMenuClass:function(A){if(this.vertical){return"iceMnuBarVrtSubMenu";}else{return"iceMnuBarSubMenu";}},getSubMenuIndClass:function(A){if(this.vertical){return"iceMnuBarVrtSubMenuInd";}else{return"iceMnuBarSubMenuInd";}},getRootClass:function(){if(this.vertical){return"iceMnuBarVrt";}else{return"iceMnuBar";}},getMenuItemClass:function(){return"iceMnuItm";},getPopupMenuClass:function(){return"iceMnuPopVrtItem";},hover:function(D,B,A){if(!A){if(Ice.Menu.currentHover&&Ice.Menu.currentHover==B.id){return ;}}Ice.Menu.currentHover=B.id;if(this.clicked){var C=$(B.id+"_sub");Ice.Menu.hideOrphanedMenusNotRelatedTo(B);if(this.vertical){Ice.Menu.show(this.component,C,B);}else{Ice.Menu.show(B,C,null);}}},mousedown:function(B,A){if(this.clicked){this.clicked=false;}else{this.clicked=true;this.hover(B,A,true);}},focus:function(B,A){this.hover(B,A);},configureRootItems:function(){var B=this.component.childNodes;for(i=0;i<B.length;i++){var C=B[i];if(C.tagName=="DIV"){if(Element.hasClassName(C,this.getMenuBarItemClass())){C.onmouseover=this.hover.bindAsEventListener(this,C);var A=C.firstChild;if(A.tagName=="A"){A.onfocus=this.focus.bindAsEventListener(this,C);}if(this.displayOnClick){C.onmousedown=this.mousedown.bindAsEventListener(this,C);this.clicked=false;}}}}},hideAll:function(C){element=Event.element(C);var A=element.up("."+this.getMenuBarItemClass());var B=C.element();if(B&&B.match("a[onclick]")){B=B.down();}if(B){B=B.up(".iceMnuItm a[onclick^='return false']");}if(!(A&&this.clicked)&&!B){Ice.Menu.hideAll();if(this.displayOnClick){this.clicked=false;}}C.stopPropagation();},hideAllDocument:function(A){if(this.displayOnClick){this.clicked=false;}Ice.Menu.hideAll();},showMenu:function(B){element=Event.element(B);var A=element.up("."+this.getMenuBarItemClass());if(A&&this.displayOnClick){this.mousedown(B);}}});