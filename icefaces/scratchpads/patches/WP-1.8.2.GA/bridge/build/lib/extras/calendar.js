Ice.Calendar={};Ice.Calendar.listeners={};Ice.Calendar.addCloseListener=function(D,B,C,A){if(Ice.Calendar.listeners[D]){return ;}else{Ice.Calendar.listeners[D]=new Ice.Calendar.CloseListener(D,B,C,A);}};Ice.Calendar.CloseListener=Class.create({initialize:function(D,B,C,A){this.calendarId=D;this.formId=B;this.commandLinkId=C;this.hiddenFieldId=A;this.popupId=this.calendarId+"_ct";this.buttonId=this.calendarId+"_cb";this.handler=this.closePopupOnClickOutside.bindAsEventListener(this);Event.observe(document,"mousedown",this.handler);},closePopupOnClickOutside:function(A){if(this.getPopup()){if(this.isInPopup(A.element())){return ;}if(this.isWithin(this.getPopup(),A)){return ;}if(A.element()==this.getButton()){this.dispose();return ;}var B=A.element().id;if(B){setFocus(B);}else{setFocus("");}this.submit(A);this.dispose();}},isInPopup:function(A){if(A.id==this.popupId){return true;}if(A==undefined||A==document){return false;}return this.isInPopup(A.parentNode);},isWithin:function(A,B){return Position.within(A,Event.pointerX(B),Event.pointerY(B));},dispose:function(){Ice.Calendar.listeners[this.calendarId]=null;Event.stopObserving(document,"mousedown",this.handler);},submit:function(A){document.forms[this.formId][this.commandLinkId].value=this.getButton().id;document.forms[this.formId][this.hiddenFieldId].value="toggle";iceSubmitPartial(document.forms[this.formId],this.getButton(),A);},getPopup:function(){return $(this.popupId);},getButton:function(){return $(this.buttonId);}});