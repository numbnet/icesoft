var visibleTooltipList=new Array();ToolTipPanelPopup=Class.create({initialize:function(I,K,A,D,E,C,J,F,H,G,B){this.src=I;this.delay=E||500;this.dynamic=(C=="true");this.tooltipCompId=K;this.srcCompId=I.id;this.hideOn=D;this.x=Event.pointerX(A);this.y=Event.pointerY(A);this.formId=J;this.ctxValue=F;this.iFrameUrl=H;this.moveWithMouse=B;A.cancelBubble=true;if(this.hideOn=="mousedown"){this.hideEvent=this.hidePopupOnMouseClick.bindAsEventListener(this);}else{if(this.hideOn=="mouseout"){this.hideEvent=this.hidePopupOnMouseOut.bindAsEventListener(this);}else{this.hideOn="none";}}this.eventMouseMove=this.updateCordinate.bindAsEventListener(this);this.clearTimerEvent=this.clearTimer.bindAsEventListener(this);Event.observe(document,"mouseout",this.clearTimerEvent);Event.observe(document,this.hideOn,this.hideEvent);Event.observe(document,"mousemove",this.eventMouseMove);if(G=="hover"){this.timer=setTimeout(this.showPopup.bind(this),parseInt(this.delay));}else{this.showPopup.bind(this)();Event.extend(A).stop();}},showPopup:function(){if(this.isTooltipVisible()){return ;}if(this.dynamic){var B=this.getTooltip();if(B){B.style.visibility="hidden";var A=B.childNodes[0];if(A){B.removeChild(A);}}this.submit("show");if(this.hideOn=="none"){this.populateFields(true);}}else{var B=this.getTooltip();B.style.visibility="visible";B.style.position="absolute";B.style.display="";B.style.top=this.y-B.offsetHeight-4+"px";B.style.left=this.x+4+"px";ToolTipPanelPopupUtil.adjustPosition(B);Ice.iFrameFix.start(this.tooltipCompId,this.iFrameUrl);}this.addToVisibleList();},hidePopupOnMouseOut:function(A){if(!this.isTooltipVisible()){return ;}if(Position.within($(this.tooltipCompId),Event.pointerX(A),Event.pointerY(A))){return ;}this.hidePopup(A);this.state="hide";this.populateFields();if(this.hideOn=="mouseout"){this.removedFromVisibleList();}this.dispose(A);},hidePopupOnMouseClick:function(A){if(!this.isTooltipVisible()||!Event.isLeftClick(A)){return ;}var B=Event.element(A);if(this.srcOrchildOfSrcElement(B)){return ;}else{this.hidePopup(A);}if(this.hideOn=="mousedown"){this.removedFromVisibleList();}this.dispose(A);},dispose:function(A){Event.stopObserving(document,this.hideOn,this.hideEvent);Event.stopObserving(document,"mousemove",this.eventMouseMove);},hidePopup:function(A){if(this.dynamic){this.submit("hide");}else{tooltip=this.getTooltip();tooltip.style.visibility="hidden";tooltip.style.display="none";}},submit:function(D,C){if(!C){C=new Object();}this.state=D;this.populateFields();var A=$(this.srcCompId);try{var B=Ice.util.findForm(A);iceSubmitPartial(B,A,C);}catch(E){logger.info("Form not found"+E);}},clearTimer:function(){Event.stopObserving(document,"mouseout",this.clearTimerEvent);clearTimeout(this.timer);},updateCordinate:function(A){if(Event.element(A)!=this.src&&!A.element().descendantOf(this.src)){return ;}this.x=Event.pointerX(A);this.y=Event.pointerY(A);if(!this.isTooltipVisible()||!this.moveWithMouse){return ;}var B=this.getTooltip();B.style.top=this.y-B.offsetHeight-4+"px";B.style.left=this.x+4+"px";ToolTipPanelPopupUtil.adjustPosition(B);Ice.iFrameFix.start(this.tooltipCompId,this.iFrameUrl);},srcOrchildOfSrcElement:function(B){var A=this.getTooltip();if(A==B){return true;}while(B.parentNode){B=B.parentNode;if(A==B){return true;}}},getTooltip:function(){return $(this.tooltipCompId);},populateFields:function(B){var A=$(this.formId);if(A==null){return ;}var C=A.getElements().find(function(D){if(D.id=="iceTooltipInfo"){return D;}});if(!C){C=document.createElement("input");C.id="iceTooltipInfo";C.name="iceTooltipInfo";C.type="hidden";A.appendChild(C);}else{}if(B){C.value="";}else{C.value="tooltip_id="+this.tooltipCompId+"; tooltip_src_id="+this.src.id+"; tooltip_state="+this.state+"; tooltip_x="+this.x+"; tooltip_y="+this.y+"; cntxValue="+this.ctxValue;}},addToVisibleList:function(){if(!this.isTooltipVisible()){this.removedFromVisibleList("all");visibleTooltipList[parseInt(visibleTooltipList.length)]={tooltipId:this.tooltipCompId,srcCompId:this.srcCompId};}else{}},removedFromVisibleList:function(C){if(this.isTooltipVisible()||C){var B=new Array();var A=-1;for(i=0;i<visibleTooltipList.length;i++){if(visibleTooltipList[i].tooltipId!=this.tooltipCompId){A=parseInt(A)+1;B[A]=visibleTooltipList[i];}else{}}visibleTooltipList=B;}else{}},isTooltipVisible:function(A){for(i=0;i<visibleTooltipList.length;i++){if(A){if(visibleTooltipList[i].tooltipId==this.tooltipCompId){return true;}}else{if(visibleTooltipList[i].tooltipId==this.tooltipCompId&&visibleTooltipList[i].srcCompId==this.srcCompId){return true;}}}return false;}});ToolTipPanelPopupUtil={removeFromVisibleList:function(C){var B=new Array();var A=-1;for(i=0;i<visibleTooltipList.length;i++){if(visibleTooltipList[i].tooltipId!=C){A=parseInt(A)+1;B[A]=visibleTooltipList[i];}else{}}visibleTooltipList=B;},adjustPosition:function(H){var B=$(H);var E=document.viewport.getDimensions();var F=document.viewport.getScrollOffsets();var A=B.getDimensions();var D=B.cumulativeOffset();var C=B.positionedOffset();var G=0;if(D.left<F.left){G=F.left-D.left;}else{if(D.left+A.width>F.left+E.width){G=(D.left+A.width)-(F.left+E.width);G=-Math.min(G,(D.left-F.left));}}B.style.left=C.left+G+"px";G=0;if(D.top<F.top){G=F.top-D.top;}else{if(D.top+A.height>F.top+E.height){G=(D.top+A.height)-(F.top+E.height);G=-Math.min(G,(D.top-F.top));}}B.style.top=C.top+G+"px";},showPopup:function(B){var A=$(B);A.style.top=parseInt(A.style.top)-A.offsetHeight-4+"px";A.style.left=parseInt(A.style.left)+4+"px";ToolTipPanelPopupUtil.adjustPosition(B);}};