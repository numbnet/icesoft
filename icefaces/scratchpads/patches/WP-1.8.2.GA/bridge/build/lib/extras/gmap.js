var GMapRepository=new Array();var GMapWrapper=Class.create();GMapWrapper.prototype={initialize:function(A,B){this.eleId=A;this.realGMap=B;this.controls=new Object();this.overlays=new Object();this.geoMarker=new Object();this.geoMarkerAddress;this.geoMarkerSet=false;},getElementId:function(){return this.eleId;},getRealGMap:function(){return this.realGMap;},getControlsArray:function(){return this.controls;}};Ice.GoogleMap=Class.create();Ice.GoogleMap={getGeocoder:function(B){var A=GMapRepository[B+"geo"];if(A==null){GMapRepository[B+"geo"]=new GClientGeocoder();return GMapRepository[B+"geo"];}else{return A;}},getGDirection:function(E,C){var B=GMapRepository[E+"dir"];if(B==null){var D=Ice.GoogleMap.getGMapWrapper(E).getRealGMap();var A=document.getElementById(C);GMapRepository[E+"dir"]=new GDirections(D,A);return GMapRepository[E+"dir"];}else{return B;}},getGMapWrapper:function(C){var A=GMapRepository[C];if(A){var B=document.getElementById(C);if(!B.hasChildNodes()){A=Ice.GoogleMap.recreate(C,A);}}else{A=Ice.GoogleMap.create(C);}return A;},loadDirection:function(F,B,C){var E=GMapRepository[F+"dir"];var D=Ice.GoogleMap.getGMapWrapper(F).getRealGMap();if(E==null){var A=document.getElementById(B);E=new GDirections(D,A);GMapRepository[F+"dir"]=E;}E.load(C);},addOverlay:function(ele,overlayId,ovrLay){var gmapWrapper=Ice.GoogleMap.getGMapWrapper(ele);var overlay=gmapWrapper.overlays[overlayId];if(overlay==null){overlay=eval(ovrLay);gmapWrapper.getRealGMap().addOverlay(overlay);gmapWrapper.overlays[overlayId]=overlay;}},removeOverlay:function(D,C){var A=Ice.GoogleMap.getGMapWrapper(D);var B=A.overlays[C];if(B!=null){A.getRealGMap().removeOverlay(B);}else{return ;}var E=new Object();for(overlayObj in A.overlays){if(C!=overlayObj){E[overlayObj]=A.overlays[overlayObj];}}A.overlays=E;},locateAddress:function(A,B){var D=function(E){if(!E){alert(B+" not found");}else{var G=Ice.GoogleMap.getGMapWrapper(A);if(G){G.getRealGMap().setCenter(E,13);var F=new GMarker(E);G.getRealGMap().addOverlay(F);F.openInfoWindowHtml(B);G.geoMarker=F;G.geoMarkerAddress=B;Ice.GoogleMap.submitEvent(A,G.getRealGMap(),"geocoder");}else{}}};var C=Ice.GoogleMap.getGeocoder(A);C.getLatLng(B,D);},create:function(D){var B=new GMapWrapper(D,new GMap2(document.getElementById(D)));var A=document.getElementById(D+"hdn");var C=false;GEvent.addListener(B.getRealGMap(),"zoomend",function(F,E){if(F!=null){Ice.GoogleMap.submitEvent(D,B.getRealGMap(),"zoomend",E);}});GEvent.addListener(B.getRealGMap(),"dragend",function(){Ice.GoogleMap.submitEvent(D,B.getRealGMap(),"dragend");});GEvent.addListener(B.getRealGMap(),"maptypechanged",function(){if(C){var E=$(D+"type");E.value=B.getRealGMap().getCurrentMapType().getName();Ice.GoogleMap.submitEvent(D,B.getRealGMap(),"maptypechanged");}C=true;});initializing=false;GMapRepository[D]=B;return B;},submitEvent:function(M,B,G,F){try{var A=B.getCenter();var J=$(M+"lat");var K=$(M+"lng");var C=$(M+"event");var L=$(M+"zoom");var I=$(M+"type");J.value=A.lat();K.value=A.lng();C.value=G;if(F==null){L.value=B.getZoom();}else{L.value=F;if(L.value==B.getZoom()){return ;}}var D=Ice.util.findForm(J);var E=new Object();iceSubmitPartial(D,J,E);C.value="";}catch(H){}},recreate:function(F,B){Ice.GoogleMap.remove(F);var C=B.controls;var E=B.geoMarker;var A=B.geoMarkerAddress;B=Ice.GoogleMap.create(F);B.geoMarker=E;B.geoMarkerAddress=A;B.geoMarkerSet="true";var D=new Object();for(control in C){if(D[control]==null){Ice.GoogleMap.removeControl(F,control);Ice.GoogleMap.addControl(F,control);}}return B;},addControl:function(ele,controlName){var gmapWrapper=Ice.GoogleMap.getGMapWrapper(ele);var control=gmapWrapper.controls[controlName];if(control==null){control=eval("new "+controlName+"()");gmapWrapper.getRealGMap().addControl(control);gmapWrapper.controls[controlName]=control;}},removeControl:function(C,E){var A=Ice.GoogleMap.getGMapWrapper(C);var D=A.controls[E];if(D!=null){A.getRealGMap().removeControl(D);}var B=new Object();for(D in A.controls){if(E!=D){B[D]=A.controls[D];}}A.controls=B;},remove:function(B){var A=new Array();for(map in GMapRepository){if(map!=B){A[map]=GMapRepository[map];}}GMapRepository=A;},setMapType:function(C,B){var A=Ice.GoogleMap.getGMapWrapper(C);if(A.geoMarkerSet&&A.geoMarker!=null&&A.geoMarkerAddress!=null){A.getRealGMap().addOverlay(A.geoMarker);A.geoMarker.openInfoWindowHtml(A.geoMarkerAddress);A.geoMarkerSet=false;}if(A.getRealGMap().getCurrentMapType()!=null){if(A.getRealGMap().getCurrentMapType().getName()!=B){switch(B){case"Satellite":A.getRealGMap().setMapType(G_SATELLITE_MAP);break;case"Hybrid":A.getRealGMap().setMapType(G_HYBRID_MAP);break;case"Map":A.getRealGMap().setMapType(G_NORMAL_MAP);break;}}}}};