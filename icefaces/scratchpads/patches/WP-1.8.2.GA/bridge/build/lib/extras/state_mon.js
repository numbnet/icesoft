Ice.StateMon=Class.create();Ice.StateMon={logger:null,monitors:Array(),add:function(A){this.logger.debug("Added monitor for ["+A.id+"] type ["+A.type+"]");this.monitors.push(A);},checkAll:function(){var D=0;var A=null;var C=this.monitors.length;for(D=0;D<C;D++){A=this.monitors[D];try{if(A.changeDetected()){this.logger.debug("Monitor ["+A.id+"] has been replaced");A.rebuildMe=true;}else{this.logger.debug("Monitor ["+A.id+"] has not been replaced");A.rebuildMe=false;}if(!this.elementExists(A.id)){this.logger.debug("Monitor ["+A.id+"] no longer exists in dom");A.destroyMe=true;}}catch(B){this.logger.error("Error checking monitor ["+A.id+"] Msg ["+B+"]");}}this.destroy();this.rebuild();},removeMonitors:function(B){var A=Array();var C=0;for(C=0;C<this.monitors.length;C++){if(!this.monitors[C].removeMe){A.push(this.monitors[C]);}}this.monitors=A;},destroy:function(){var D=0;var A=null;var E=Array();for(D=0;D<this.monitors.length;D++){A=this.monitors[D];try{if(!A.destroyMe){E.push(A);}else{try{this.logger.debug("Destroyed monitor ["+A.id+"]");A.destroy();}catch(C){this.logger.warn("Monitor ["+A.id+"] destroyed with exception ["+C+"]");}A=null;}}catch(B){this.logger.error("Error destroying monitor ["+A.id+"] Msg ["+B+"]");}}this.monitors=E;},destroyAll:function(){var C=0;var A=null;var D=Array();for(C=0;C<this.monitors.length;C++){A=this.monitors[C];try{if(A!=null){this.logger.debug("Destroyed monitor ["+A.id+"]");A.destroy();}}catch(B){this.logger.warn("Monitor ["+A.id+"] destroyed with exception ["+B+"]");}A=null;}this.monitors=Array();},rebuild:function(){var B=this.monitors.length;try{for(i=0;i<B;i++){monitor=this.monitors[i];if(monitor.rebuildMe){this.logger.debug("Rebuilding ["+monitor.id+"]");try{monitor.destroy();}catch(C){this.logger.warn("Could not destroy monitor before rebuilding ID["+monitor.id+"] msg ["+C+"]");}monitor.rebuild();monitor.rebuildMe=false;monitor.removeMe=true;}else{this.logger.debug("Not rebuilding ["+monitor.id+"] type ["+monitor.type+"]");}}this.removeMonitors();}catch(A){this.logger.error("Error rebuilding monitors ["+A+"]");}},elementExists:function(B){var A=$(B);if(!A){return false;}return true;},elementReplaced:function(B){if(B&&!B.id){return false;}var A=$(B.id);if(!A){this.logger.debug("Element not found id["+B.id+"] element["+B+"] type ["+B.nodeName+"]");}if(A!=null&&A!=B){this.logger.debug("Element replaced");return true;}}};Ice.MonitorBase=Class.create();Ice.MonitorBase.prototype={object:null,id:null,htmlElement:null,rebuildMe:false,rebuild:function(){},createOptions:null,options:null,destroyMe:false,destroy:function(){},type:"Base",initialize:function(){},changeDetected:function(){return Ice.StateMon.elementReplaced(this.htmlElement);},removeMe:false};Ice.SortableMonitor=Class.create();Ice.SortableMonitor.prototype=Object.extend(new Ice.MonitorBase(),{initialize:function(B,A){this.type="Sortable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){Sortable.destroy(this.htmlElement);},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Sortable ID["+this.id+"] Options["+this.createOptions+"]");Sortable.create(this.id,this.createOptions);},changeDetected:function(){return true;}});Ice.DraggableMonitor=Class.create();Ice.DraggableMonitor.prototype=Object.extend(new Ice.MonitorBase(),{initialize:function(B,A){this.type="Draggable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){this.object.destroy();Ice.StateMon.logger.debug("Destroyed Draggable ["+this.id+"]");$A(Draggables.drags).each(function(A){Ice.StateMon.logger.debug("Draggable ["+A.element.id+"] not destroyed");});},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Draggable ID["+this.id+"] Options["+this.createOptions+"]");var A=new Draggable(this.id,this.createOptions);Ice.StateMon.logger.debug("Rebuilding Draggable ID["+this.id+"] Options["+this.createOptions+"] Complete");}});Ice.DroppableMonitor=Class.create();Ice.DroppableMonitor.prototype=Object.extend(new Ice.MonitorBase,{initialize:function(B,A){this.type="Droppable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){Droppables.remove(this.htmlElement);},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Droppables ID["+this.id+"] Options["+this.createOptions+"]");Droppables.add(this.id,this.createOptions);}});Ice.AutocompleterMonitor=Class.create();Ice.AutocompleterMonitor.prototype=Object.extend(new Ice.MonitorBase,{initialize:function(D,E,C,A,B){this.type="Autocompleter";this.object=null;this.id=D.id;this.htmlElement=D;this.createOptions=C;this.update=E;this.rowClass=A;this.selectedRowClass=B;},destroy:function(){this.object.dispose();},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Autocompleter ID["+this.id+"] Options["+this.createOptions+"]");return new Ice.Autocompleter(this.id,this.update.id,this.createOptions,this.rowClass,this.selectedRowClass);}});