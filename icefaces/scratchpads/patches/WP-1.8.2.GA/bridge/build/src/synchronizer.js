[Ice.Document=new Object,Ice.ElementModel.Element,Ice.Connection,Ice.Ajax].as(function(D,A,C,B){D.replaceContainerHTML=function(H,I){var L=new RegExp("<body[^<]*>","g").exec(I);var G=new RegExp("</body>","g").exec(I);var F=I.substring(L.index,G.index+G[0].length);var K=F.substring(F.indexOf(">")+1,F.lastIndexOf("<"));var E=H.tagName;var J=$element(H);J.disconnectEventListeners();J.replaceHtml(["<",E,">",K,"</",E,">"].join(""));};D.Synchronizer=Object.subclass({initialize:function(E,G,I){this.logger=E.child("synchronizer");this.ajax=new B.Client(this.logger);var H="history-frame:"+G+":"+I;try{window.frames[H].location.hash;this.historyFrame=window.frames[H];}catch(F){this.historyFrame=H.asElement().contentWindow;}try{if(this.historyFrame.location.hash.length>0){this.reload();}}catch(F){this.logger.error("History frame reload failed: "+F);}},synchronize:function(){this.synchronize=Function.NOOP;try{if(!this.historyFrame.location.hash.contains("reload")){this.historyFrame.location.replace(this.historyFrame.location+"#reload");this.logger.debug("mark document as modified");}}catch(E){this.logger.warn("could not mark document as modified",E);}},reload:function(){try{this.logger.info("synchronize body");this.ajax.getAsynchronously(document.URL,"",function(F){F.setRequestHeader("Connection","close");F.on(C.OK,function(G){D.replaceContainerHTML(document.body,G.content());});});}catch(E){this.logger.error("failed to reload body",E);}},shutdown:function(){this.synchronize=Function.NOOP;}});});