<?xml version="1.0" encoding="utf-8" ?>
<project name="icechat-spring" default="war">

	<property name="root.offset" value="../../../.." />
	<property file="${root.offset}/build.properties" />

	<import file="${root.offset}/build-common.xml" />
	<import file="../../build-common.xml" />


	<target name="war" depends="compile">
		<echo>Building war @{war.file.name}...</echo>
		<mkdir dir="${dist.dir}" />
		<mkdir dir="${build.dir}/webapp" />
		<copy todir="${build.dir}/webapp" preservelastmodified="true" verbose="true">
			<fileset dir="${web.dir}">
				<include name="**" />
			</fileset>
		</copy>
		<copy todir="${build.dir}/webapp/css" preservelastmodified="true" verbose="true">
			<fileset dir="../${common.resource.dir}/css">
				<include name="**" />
			</fileset>
		</copy>
		<copy todir="${build.dir}/webapp/img" preservelastmodified="true" verbose="true">
			<fileset dir="../${common.resource.dir}/img">
				<include name="**" />
			</fileset>
		</copy>
		<copy todir="${build.dir}/webapp/WEB-INF/lib" preservelastmodified="true" verbose="true">
			<fileset refid="icepush.dist" />
			<fileset refid="api" />
			<fileset refid="cdi" />
			<fileset refid="beans" />
		</copy>
		<mkdir dir="${build.dir}/webapp/WEB-INF/classes" />
		<copy todir="${build.dir}/webapp/WEB-INF/classes" preservelastmodified="true" verbose="true">
			<fileset dir="${build.dir}/classes">
				<include name="**" />
			</fileset>
		</copy>

		<war basedir="${build.dir}/webapp" destfile="${dist.dir}/${ant.project.name}.war" webxml="${build.dir}/webapp/WEB-INF/web.xml">
		</war>
	</target>

	<target name="compile" depends="clean">
		<compile>
			<add.classpath.elements>
				<fileset refid="api" />
				<fileset refid="beans" />
				<fileset refid="cdi" />
				<fileset dir="lib" />
			</add.classpath.elements>
		</compile>
	</target>

</project>
