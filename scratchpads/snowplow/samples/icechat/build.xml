<project default="jsf2" name="icechat">
	
	<target name="api">
		<ant antfile="build.xml" target="jar" dir="./api"/>
	</target>
	
	<target name="auth" depends="api">
		<ant antfile="build.xml" target="jar" dir="./auth"/>
	</target>
	
	<target name="beans" depends="api">
		<ant antfile="build.xml" target="jar" dir="./beans"/>
	</target>
	
	<target name="cdi-beans" depends="beans">
		<ant antfile="build.xml" target="jar" dir="./cdi"/>
	</target>
		
	<target name="jaxrs" depends="cdi-beans">
		<ant antfile="build.xml" target="jar" dir="./jee6/jaxrs"/>
	</target>

	<target name="wicket" depends="cdi-beans"> 
		<ant antfile="build.xml" target="war" dir="./web/wicket"/>
	</target>

	<target name="jsf2" depends="cdi-beans">
		<ant antfile="build.xml" target="war" dir="./web/jsf2"/>
	</target>

	<target name="gwt" depends="beans">
		<ant target="war" dir="./gwt"/>
	</target>
	
	<target name="icefaces2" depends="cdi-beans">
		<ant antfile="build.xml" target="war" dir="./icefaces"/>
	</target>

	<target name="gwt-devmode" depends="beans">
		<ant antfile="build.xml" target="devmode" dir="./web/gwt"/>
	</target>

	<target name="ajax" depends="auth,beans">
		<ant target="war" dir="ajax"/>
	</target>	

	<target name="jquery" depends="ajax">
		<ant antfile="build.xml" target="war" dir="./web/jquery"/>
	</target>	

	<target name="spring" depends="cdi-beans">
		<ant antfile="build.xml" target="war" dir="./web/spring"/>
	</target>
	
	<target name="spring-region" depends="cdi-beans">
		<ant antfile="build.xml" target="war" dir="./web/spring-region"/>
	</target>
	
	<target name="clean-all">
		<ant target="clean" dir="./api"/>
		<ant target="clean" dir="./auth"/>
		<ant target="clean" dir="./beans"/>
		<ant target="clean" dir="./cdi"/>
		<ant target="clean" dir="./web/wicket"/>
		<ant target="clean" dir="./jsf2"/>
		<ant target="clean" dir="./ajax"/>
		<ant target="clean" dir="./gwt"/>
		<ant target="clean" dir="./jquery"/>
		<ant target="clean" dir="./icefaces"/>
		<ant target="clean" dir="./prototype"/>
		<ant target="clean" dir="./web/spring"/>
		<ant target="clean" dir="./web/spring-region"/>
	</target>
	
	<fileset id="src.api" dir="./api">
		<include name="**" />
	</fileset>
	<fileset id="src.beans" dir="./beans">
		<include name="**" />
	</fileset>
	<fileset id="src.auth" dir="./auth">
		<include name="**" />
	</fileset>
	<fileset id="src.gwt" dir="./gwt">
		<include name="**" />
	</fileset>
	
	<path id="gwt.package.paths">
		<fileset refid="src.api"/>
		<fileset refid="src.beans"/>
		<fileset refid="src.gwt"/>
	</path>
	
	<macrodef name="package.src">
		<element name="add.package.elements" optional="true" />
		<attribute name="target"/>
		<sequential>
			<ant dir="./@{target}" target="clean"/>
			<ant dir="./api" target="clean"/>
			<ant dir="./auth" target="clean"/>
			<ant dir="./beans" target="clean"/>
			<ant dir="./cdi" target="clean"/>
			<delete dir="./package"/>
			<mkdir dir="./package"/>
			<copy todir="./package/@{target}">
				<fileset dir="@{target}"/>
			</copy>
			<add.package.elements/>			
		</sequential>
	</macrodef>

	
	<target name="package.gwt">
		<package.src target="gwt">
			<add.package.elements>
				<copy todir="./package/api">
					<fileset refid="src.api"/>
				</copy>
				<copy todir="./package/beans">
					<fileset refid="src.beans"/>
				</copy>
			</add.package.elements>
		</package.src>
	</target>
		
</project>
