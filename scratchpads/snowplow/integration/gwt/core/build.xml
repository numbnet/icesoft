<project name="GWT Icepush Integration Bundle" default="jar">
	<property file="local.properties"/>
	<target name="clean">
		<delete dir="${build.dir}"/>
		<delete dir="${dist.dir}"/>
		<delete dir="${build.tests}"/>
	</target>
	
	<target name="init-compile">
		<mkdir dir="${build.dir}"/>
	</target>
	<target name="compile" depends="init-compile">
		<javac srcdir="${java.src.dir}" destdir="${build.dir}" debug="on" debuglevel="lines,vars,source" 
			source="1.5" target="1.5">
			<classpath>
  				<fileset dir="lib/gwt" includes="**/*.jar"/>
				<fileset dir="../../../core/build/dist" includes="*.jar"/>
		</classpath>
		</javac>
	
	</target>
	<target name="copy-source">
		<copy todir="${build.dir}">
			<fileset dir="${java.src.dir}" includes="**/*.java"/>
			<fileset dir="${java.src.dir}" includes="**/*.gwt.xml"/>
		</copy>
	</target>
	<target name="jar" depends="test.dev,copy-source">
		<mkdir dir="${dist.dir}"/>
		<jar basedir="${build.dir}" destfile="${dist.dir}/icepush-gwt.jar"/>
	</target>

 <target name="javac.tests" depends="compile" description="Compiles test code">
  	<mkdir dir="${build.tests}"/>
    <javac srcdir="test" destdir="${build.tests}" includes="**" encoding="utf-8"
      source="1.5" target="1.5" nowarn="true"
      debug="true" debuglevel="lines,vars,source">
		<classpath>
			<pathelement location="${build.dir}"/>
  			<fileset dir="lib" includes="**/*.jar"/>
		</classpath>
    </javac>
    
  </target>
  
  <target name="test.dev" depends="javac.tests" description="Run development mode tests">
    
    <mkdir dir="reports"/>
    <junit printsummary="withOutAndErr" haltonfailure="yes">
      	<formatter type="plain"/>
		<classpath>
			<pathelement location="${build.dir}"/>
			<pathelement location="${build.tests}"/>
  			<fileset dir="lib" includes="**/*.jar"/>
		</classpath>
      	<batchtest fork="yes" todir="reports">
    		<fileset dir="test">
      			<include name="**/*Test*.java"/>
      			<exclude name="**/AllTests.java"/>
    		</fileset>
  		</batchtest>
    </junit>
    <!--junit fork="yes" printsummary="yes" haltonfailure="yes">
      <jvmarg line="-Xmx256m" />
      <sysproperty key="gwt.args" value="-logLevel WARN" />
      <sysproperty key="java.awt.headless" value="true" />
      <classpath>
        <pathelement location="src" />
        <pathelement location="test" />
        <path refid="project.class.path" />
        <pathelement location="path_to_the_junit_jar" />
      </classpath>
      <batchtest todir="reports/htmlunit.dev" >
        <fileset dir="test" >
          <include name="**/*Test.java" />
        </fileset>
      </batchtest>
      <formatter type="plain" />
      <formatter type="xml" />
    </junit-->
  </target>
	
	
</project>