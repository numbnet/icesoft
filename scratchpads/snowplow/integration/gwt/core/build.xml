<project name="icepush-gwt" default="jar">

	<property file="local.properties" />
	<property name="root.offset" value="../../.." />
	<property file="${root.offset}/build.properties" />
	<import file="${root.offset}/build-common.xml" />

	<target name="clean">
		<clean>
			<add.filesets>
				<fileset dir="reports" />
			</add.filesets>
		</clean>
	</target>

	<target name="init-compile">
		<mkdir dir="${build.dir}" />
	</target>

	<target name="compile" depends="init-compile">
		<icepush.available />
		<compile>
			<add.classpath.elements>
				<fileset dir="lib/gwt" includes="**/*.jar" />
			</add.classpath.elements>
		</compile>
	</target>

	<target name="copy-source">
		<copy todir="${classes.dir}">
			<fileset dir="${java.src.dir}" includes="**/*.java" />
			<fileset dir="${java.src.dir}" includes="**/*.gwt.xml" />
		</copy>
	</target>

	<target name="jar" depends="copy-source">
		<build.jar />
		<antcall target="test.dev" />
	</target>

	<target name="javac.tests" depends="compile" description="Compiles test code">
		<mkdir dir="${build.tests}" />
		<javac srcdir="test" destdir="${build.tests}" includes="**" encoding="utf-8" source="1.5" target="1.5" nowarn="true" debug="true" debuglevel="lines,vars,source">
			<classpath>
				<pathelement location="${classes.dir}" />
				<fileset dir="lib" includes="**/*.jar" />
			</classpath>
		</javac>
	</target>

	<target name="test.dev" depends="javac.tests" description="Run development mode tests">
		<mkdir dir="reports" />
		<junit printsummary="withOutAndErr" haltonfailure="yes">
			<formatter type="plain" />
			<classpath>
				<pathelement location="${classes.dir}" />
				<pathelement location="${build.tests}" />
				<fileset dir="lib" includes="**/*.jar" />
			</classpath>
			<batchtest fork="yes" todir="reports">
				<fileset dir="test">
					<include name="**/*Test*.java" />
					<exclude name="**/AllTests.java" />
				</fileset>
			</batchtest>
		</junit>
	</target>


</project>