<!--
  ~ Version: MPL 1.1
  ~
  ~ "The contents of this file are subject to the Mozilla Public License
  ~ Version 1.1 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://www.mozilla.org/MPL/
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations under
  ~ the License.
  ~
  ~ The Original Code is ICEfaces 1.5 open source software code, released
  ~ November 5, 2006. The Initial Developer of the Original Code is ICEsoft
  ~ Technologies Canada, Corp. Portions created by ICEsoft are Copyright (C)
  ~ 2004-2010 ICEsoft Technologies Canada, Corp. All Rights Reserved.
  ~
  ~ Contributor(s): _____________________.
  ~
  -->

<project name="ace-showcase" default="servlet-profile">
    
    <property file="./build.properties"/>
    <property file="../build/build.properties"/>
    <import file="../build/common.xml"/>
    
    <property name="portlet.dir" location="./src/portlets"/>
    <property name="portlet.build.dir" location="${build.dir}/portlets"/>
    <property name="portlet.lib.dir" location="${lib.dir}/portlets"/>

    <patternset id="portlet.jars">
        <include name="jsf*.jar"/>
        <include name="portletfaces*.jar"/>
        <include name="slf4j*.jar"/>
    </patternset>

    <target name="portletize" 
            depends="web-profile" 
            description="Adds portlet content to the .war file">
            
        <mkdir dir="${portlet.build.dir}/exploded"/>
        <unzip src="${dist.dir}/${ant.project.name}.war" 
               dest="${portlet.build.dir}/exploded"/>

        <copy todir="${portlet.build.dir}/exploded">
          <fileset dir="${portlet.dir}/webapp">
            <include name="view.xhtml"/>
          </fileset>
        </copy>

        <copy todir="${portlet.build.dir}/exploded/WEB-INF">
          <fileset dir="${portlet.dir}/webapp/WEB-INF">
              <include name="*.xml"/>
              <include name="*.properties"/>
          </fileset>
        </copy>

        <copy todir="${portlet.build.dir}/exploded/WEB-INF/lib">
          <fileset dir="${portlet.lib.dir}">
              <patternset refid="portlet.jars"/>
          </fileset>
        </copy>

        <zip destfile="${portlet.build.dir}/${ant.project.name}-portlet.war"
             basedir="${portlet.build.dir}/exploded"/>
    </target>

</project>
