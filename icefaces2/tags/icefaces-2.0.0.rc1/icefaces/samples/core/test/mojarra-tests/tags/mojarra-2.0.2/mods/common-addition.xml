    <!-- Add this import to the file -->
    <import file="${jsf.build.home}/common/ant/icefaces.xml"/>

    <-- For this macrodef, add the snippet indicated by the comments -->
    <macrodef name="jsf.war">
        <attribute name="basedir"/>
        <attribute name="archive-name"/>
        <attribute name="webxml"/>
        <element name="archive-elements" optional="true"/>
        <sequential>
            <echo message="Creating archive '@{archive-name}'..."/>

            <jar destfile="@{basedir}/@{archive-name}.war">
                <zipfileset file="@{webxml}"
                            prefix="WEB-INF"/>
                <archive-elements/>
            </jar>
            
             <!-- Custom ICEfaces addition -->
			 <for list="${icefaces.jars}"
				 param="jar">
				<sequential>
					<echo message="JAR: @{jar}"/>
					<jar destfile="@{basedir}/@{archive-name}.war"
						 update="true">
						<zipfileset file="@{jar}" prefix="WEB-INF/lib"/>
					</jar>
				</sequential>
			</for>
			<!-- End of Custom ICEfaces addition -->

            <if>
                <equals arg1="${build.standalone}" arg2="true"/>
                <then>
                    <echo message="Adding dependent libraries..."/>

                    <for list="${jsf-impl.jar},${jsf-api.jar},${webapp.jars}"
                         param="jar">
                        <sequential>
                            <echo message="JAR: @{jar}"/>
                            <jar destfile="@{basedir}/@{archive-name}.war"
                                 update="true">
                                <zipfileset file="@{jar}" prefix="WEB-INF/lib"/>
                            </jar>
                        </sequential>
                    </for>

                </then>
                <else>
                    <echo message="Will not package dependent libraries..."/>
                </else>
            </if>
        </sequential>
    </macrodef>

