<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <script type="text/javascript" src="../newlib/oo.js"></script>
    <script type="text/javascript" src="../newlib/functional.js"></script>
    <script type="text/javascript" src="../newlib/collection.js"></script>
    <script type="text/javascript" src="unittest.js"></script>
    <script type="text/javascript">
        function Range(start, end) {
            return Stream(function(cellConstructor) {
                if (start == end) return null;
                function range(index) {
                    if (index > end) return null;
                    return function() {
                        return cellConstructor(index, range(index + 1));
                    };
                }

                return range(start);
            });
        }

        window.onload = InPageRunner('Collection test suite', function(test) {
            test('detect arrays', function() {
                checkTrue(isArray([]), 'array is not detected');
                checkFalse(isArray(''), 'array is detected falsely');
                checkFalse(isArray(new Object), 'array is detected falsely');
            });

            test('detect strings', function() {
                checkTrue(isString(''), 'string is not detected');
                checkFalse(isString([]), 'string is detected falsely');
                checkFalse(isString(new Object), 'string is detected falsely');
            });

            test('indexed access', function() {
                checkEqual(indexOf([1, 2, 3], 1), 0);
                checkEqual(indexOf([1, 2, 3], 2), 1);
                checkEqual(indexOf(['a', 'b', 'c'], 'c'), 2);
                checkEqual(indexOf(['a', 'b', 'c'], 'd'), -1);
                checkEqual(indexOf('abc', 'a'), 0);
                checkEqual(indexOf('abc', 'b'), 1);
                checkEqual(indexOf('abc', 'c'), 2);
                checkEqual(indexOf('abc', 'd'), -1);
                checkException(function() {
                    indexOf(new Object, 'toString');
                });
            });

            test('querying', function() {
                checkEqual(size([1, 2, 3]), 3);
                checkEqual(size('abcd'), 4);
                checkEqual(size(Range(0, 3)), 4);

                checkFalse(isEmpty([1, 2, 3]));
                checkFalse(isEmpty('aaa'));
                checkFalse(isEmpty(Range(0, 3)));

                checkTrue(isEmpty([]));
                checkTrue(isEmpty(''));
                checkTrue(isEmpty(Range(0, 0)));
            });

            test('modify arrays', function() {
                checkEqual(concatenate([1, 2, 3], [3]).length, 4);
                checkEqual(concatenate([1, 2, 3], [4])[3], 4);
                var a = [1];
                checkNotEqual(concatenate(a, [1]), a);

                checkEqual(insert([1], 2).length, 2);
                checkEqual(insert([1], 2)[0], 2);
                var aa = [1];
                checkEqual(insert(aa, 3), aa);

                checkEqual(append([1], 2).length, 2);
                checkEqual(append([1], 2)[1], 2);
                var aaa = [1];
                checkEqual(append(aaa, 3), aaa);

                var aaaa = [1, 2, 3];
                empty(aaaa);
                checkEqual(size(aaaa), 0);
            });
        });
    </script>
</head>
<body/>
</html>