<?xml version="1.0" encoding="UTF-8"?>
<components xmlns="http://jboss.com/products/seam/components"
            xmlns:core="http://jboss.com/products/seam/core"
            xmlns:drools="http://jboss.com/products/seam/drools"
            xmlns:security="http://jboss.com/products/seam/security"
            xmlns:fwk="http://jboss.com/products/seam/framework"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation=
                    "http://jboss.com/products/seam/core http://jboss.com/products/seam/core-1.1.xsd
                 http://jboss.com/products/seam/drools http://jboss.com/products/seam/drools-1.1.xsd
                 http://jboss.com/products/seam/security http://jboss.com/products/seam/security-1.1.xsd
                 http://jboss.com/products/seam/components http://jboss.com/products/seam/components-1.1.xsd">

    <core:init debug="true" jndi-pattern="@jndiPattern@"/>

    <component scope="APPLICATION" auto-create="true" name="renderManager"
               class="com.icesoft.faces.async.render.RenderManager"/>

    <core:manager concurrent-request-timeout="500"
                  conversation-timeout="3600000"
                  conversation-id-parameter="cid"
                  conversation-is-long-running-parameter="clr"/>

    <core:managed-persistence-context name="entityManager"
                                      auto-create="true"
                                      persistence-unit-jndi-name="java:/seam-auctionMonitorEntityManagerFactory"/>

    <core:ejb installed="@embeddedEjb@"/>

    <!-- add this in for noConversationViewID -->
    <component name="org.jboss.seam.core.pages">
        <property name="noConversationViewId">/AuctionitemList.xhtml</property>
    </component>

    <!-- next stuff is auto generated and we can use it if we want to implement the security rules  -->
    <drools:rule-base name="securityRules">
        <drools:rule-files>
            <value>/security.drl</value>
        </drools:rule-files>
    </drools:rule-base>

    <!-- next stuff is autogenerated but we will use interceptors instead -->
    <security:identity authenticate-method="#{authenticator.authenticate}"
                       security-rules="#{securityRules}"
                       remember-me="true"/>

    <event type="org.jboss.seam.notLoggedIn">
        <action expression="#{redirect.captureCurrentView}"/>
    </event>
    <event type="org.jboss.seam.postAuthenticate">
        <action expression="#{redirect.returnToCapturedView}"/>
    </event>

    <component name="exampleBid" class="com.icesoft.eb.Bid"/>
    <fwk:entity-query name="bidList" entity-manager="#{entityManager}" ejbql="select b from Bid b"
                      order="auctionItem.title, auctionItem.itemId, timestamp desc">
        <fwk:restrictions>
            <value>lower(user.name) like lower('%' + #{exampleBid.user.name} + '%')</value>
            <value>lower(auctionItem.title) like lower('%' + #{exampleBid.auctionItem.title} + '%')</value>
        </fwk:restrictions>
    </fwk:entity-query>

</components>