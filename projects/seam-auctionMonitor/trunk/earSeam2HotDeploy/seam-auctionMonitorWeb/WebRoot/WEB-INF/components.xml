<?xml version="1.0" encoding="UTF-8"?>
<components xmlns="http://jboss.com/products/seam/components"
            xmlns:core="http://jboss.com/products/seam/core"
            xmlns:persistence="http://jboss.com/products/seam/persistence"
            xmlns:drools="http://jboss.com/products/seam/drools"
                     xmlns:fwk="http://jboss.com/products/seam/framework"
            xmlns:security="http://jboss.com/products/seam/security"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation=
                "http://jboss.com/products/seam/core http://jboss.com/products/seam/core-2.0.xsd 
                 http://jboss.com/products/seam/persistence http://jboss.com/products/seam/persistence-2.0.xsd 
                 http://jboss.com/products/seam/drools http://jboss.com/products/seam/drools-2.0.xsd
                 http://jboss.com/products/seam/bpm http://jboss.com/products/seam/bpm-2.0.xsd
                 http://jboss.com/products/seam/security http://jboss.com/products/seam/security-2.0.xsd
                 http://jboss.com/products/seam/components http://jboss.com/products/seam/components-2.0.xsd">

    <core:init debug="true" jndi-pattern="seam-auctionMonitor/#{ejbName}/local"/>

    <component scope="APPLICATION" auto-create="true" name="renderManager"
               class="com.icesoft.faces.async.render.RenderManager"/>

    <core:manager concurrent-request-timeout="500"
                  conversation-timeout="3600000"
                  conversation-id-parameter="cid"/>

    <core:managed-persistence-context name="entityManager"
                                      auto-create="true"
                                      persistence-unit-jndi-name="java:/seam-auctionMonitorEntityManagerFactory"/>


    <!-- next stuff is auto generated and we can use it if we want to implement the security rules  -->
    <drools:rule-base name="securityRules">
        <drools:rule-files>
            <value>/security.drl</value>
        </drools:rule-files>
    </drools:rule-base>

    <!-- next stuff is autogenerated but we will use interceptors instead -->
    <security:identity authenticate-method="#{authenticator.authenticate}"
                       security-rules="#{securityRules}"
                       remember-me="true"/>

    <event type="org.jboss.seam.notLoggedIn">
        <action execute="#{redirect.captureCurrentView}"/>
    </event>
    
    <event type="org.jboss.seam.postAuthenticate">
        <action execute="#{redirect.returnToCapturedView}"/>
    </event>    


    <component name="exampleUser" class="com.icesoft.eb.User"/>
    <component name="exampleItem" class="com.icesoft.eb.Auctionitem"/>
    <component name="exampleBid" class="com.icesoft.eb.Bid"/>
    <fwk:entity-query name="bidList" entity-manager="#{entityManager}" ejbql="select b from Bid b"
                      order="auctionItem.title, auctionItem.itemId, timestamp desc">
        <fwk:restrictions>
            <value>lower(b.user.name) like lower('%' + #{exampleUser.name} + '%')</value>
            <value>lower(b.auctionItem.title) like lower('%' + #{exampleItem.title} + '%')</value>
            <value>b.bidValue > #{exampleBid.bidValue}</value>
        </fwk:restrictions>
    </fwk:entity-query>

        
      
</components>